# Anthropic API ä»£ç†æœåŠ¡å™¨

ä¸“ä¸º Claude Code è®¾è®¡çš„æ™ºèƒ½ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒ**åŒæ¨¡å¼è·¯ç”±**ï¼šç›´æ¥é€ä¼ åˆ° Anthropic API æˆ–æ™ºèƒ½è½¬æ¢åˆ° OpenRouter APIï¼ŒåŒæ—¶æä¾›å…¨é¢çš„ç›‘æ§ä¸åˆ†æåŠŸèƒ½ã€‚

**[ğŸ‡ºğŸ‡¸ English Documentation](../README.md)** | **[ğŸ“ GitHub ä»“åº“](https://github.com/kingoliang/anthropic-proxy)**

## ğŸ¯ é¡¹ç›®ç›®çš„ä¸æ¦‚è¿°

### è¿™ä¸ªé¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ
æœ¬é¡¹ç›®æä¾›äº†ä¸€ä¸ª**æœ¬åœ°ä»£ç†æœåŠ¡å™¨**ï¼Œä½œä¸º Claude Code å’Œ Anthropic API ä¹‹é—´çš„æ™ºèƒ½ä¸­é—´å±‚ï¼Œå¢å¼ºæ‚¨ä½¿ç”¨ Claude çš„å¼€å‘ä½“éªŒã€‚

### ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ
å½“æ‚¨ä½¿ç”¨ Claude Code æ—¶ï¼Œé€šå¸¸ä¼šç›´æ¥å‘ Anthropic çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚è™½ç„¶è¿™æ ·è¿è¡Œå®Œç¾ï¼Œä½†æ‚¨ä¼šé”™è¿‡å¯¹ API ä½¿ç”¨æƒ…å†µçš„å®è´µæ´å¯Ÿã€‚è¿™ä¸ªä»£ç†æœåŠ¡å™¨é€šè¿‡ä»¥ä¸‹åŠŸèƒ½è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š

- ğŸ” **å®Œæ•´çš„è¯·æ±‚å¯è§†åŒ–**ï¼šæŸ¥çœ‹æ¯ä¸ª API è°ƒç”¨ï¼ŒåŒ…æ‹¬å®Œæ•´è¯·æ±‚/å“åº”ã€token ä½¿ç”¨ä¸è€—æ—¶æŒ‡æ ‡
- ğŸ“Š **ä½¿ç”¨åˆ†æ**ï¼šè·Ÿè¸ªæ¶ˆè´¹æ¨¡å¼ã€æ¨¡å‹ä½¿ç”¨ã€æˆåŠŸç‡ä¸æ€§èƒ½æŒ‡æ ‡
- ğŸ› **è°ƒè¯•æ”¯æŒ**ï¼šæ£€æŸ¥å¤±è´¥è¯·æ±‚ã€åˆ†æå“åº”æ—¶é—´ï¼Œä¾é è¯¦ç»†æ—¥å¿—æ’æŸ¥é—®é¢˜
- ğŸ’° **æˆæœ¬ç›‘æ§**ï¼šç›‘æ§ token ä½¿ç”¨å¹¶ä¼°ç®—æˆæœ¬
- ğŸ“ˆ **æ€§èƒ½ä¼˜åŒ–**ï¼šè¯†åˆ«æ…¢è¯·æ±‚ä¸ä¼˜åŒ–æç¤º

### å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
```mermaid
graph LR
    A[Claude Code] -->|API è¯·æ±‚| B[Anthropic ä»£ç†]
    B -->|è½¬å‘è¯·æ±‚| C[Anthropic API]
    C -->|è¿”å›å“åº”| B
    B -->|è¿”å›å“åº”| A
    B -->|å­˜å‚¨å’Œåˆ†æ| D[ç›‘æ§ä»ªè¡¨æ¿]
```

1. **é€æ˜ä»£ç†**ï¼šClaude Code æŒ‡å‘æœ¬åœ°ä»£ç†è€Œä¸æ˜¯ç›´æ¥è®¿é—® Anthropic
2. **è¯·æ±‚æ‹¦æˆª**ï¼šä»£ç†æ•è·æ‰€æœ‰è¯·æ±‚/å“åº”æ•°æ®ç”¨äºåˆ†æ
3. **API è½¬å‘**ï¼šè¯·æ±‚æŒ‰åŸæ ¼å¼è½¬å‘åˆ° Anthropic API
4. **å®æ—¶ç›‘æ§**ï¼šæ‰€æœ‰äº¤äº’åœ¨ Web ä»ªè¡¨æ¿ä¸­è®°å½•ä¸åˆ†æ
5. **æ•°æ®å¯¼å‡º**ï¼šå¯¼å‡ºä½¿ç”¨æ•°æ®è¿›è¡Œè¿›ä¸€æ­¥åˆ†ææˆ–æŠ¥å‘Š

### è°åº”è¯¥ä½¿ç”¨å®ƒï¼Ÿ
- **Claude Code é«˜çº§ç”¨æˆ·**ï¼šå¸Œæœ›ä¼˜åŒ– AI è¾…åŠ©å·¥ä½œæµçš„å¼€å‘è€…
- **API æˆæœ¬æ•æ„Ÿç”¨æˆ·**ï¼šéœ€è¦ç›‘æ§ä¸æ§åˆ¶ API æ”¯å‡ºçš„ç”¨æˆ·
- **å¼€å‘å›¢é˜Ÿ**ï¼šéœ€è¦äº†è§£é¡¹ç›®ä¸­ AI å·¥å…·ä½¿ç”¨æƒ…å†µçš„å›¢é˜Ÿ
- **API é›†æˆå¼€å‘è€…**ï¼šåŸºäº Anthropic API æ„å»ºåº”ç”¨çš„å¼€å‘è€…
- **æ€§èƒ½åˆ†æå¸ˆ**ï¼šå¸Œæœ›åˆ†æä¸ä¼˜åŒ–æç¤ºæ•ˆç‡çš„ç”¨æˆ·

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **åŸºäº Node.js** çš„ Anthropic API ä»£ç†
- ğŸ”€ **åŒé‡è·¯ç”±æ¨¡å¼**ï¼šç›´è¿ Anthropic API æˆ–ç»ç”± OpenRouter è‡ªåŠ¨æ ¼å¼è½¬æ¢
- ğŸ›  **é«˜çº§é…ç½®ç•Œé¢** `/config` å®æ—¶æ›´æ–°
  - å¯åˆ‡æ¢ä»£ç†æ¨¡å¼ï¼ˆAnthropic/OpenRouterï¼‰
  - ç®€åŒ–çš„ 3 æ¨¡å‹æ—æ˜ å°„ï¼ˆSonnet/Opus/Haikuï¼‰
  - OpenRouter åŠ¨æ€æ¨¡å‹åŠ è½½ä¸ 1 å°æ—¶ç¼“å­˜
  - HTML5 æ•°æ®åˆ—è¡¨å¯æœç´¢æ¨¡å‹é€‰æ‹©ä¸è¿‡æ»¤
  - æ‰€æœ‰ç”¨æˆ·æ“ä½œçš„ Toast é€šçŸ¥
  - ç›‘æ§ä¸é…ç½®é¡µé¢é—´çš„å¯¼èˆªé“¾æ¥
- ğŸ”„ **é…ç½®å®æ—¶ç”Ÿæ•ˆ** - æ‰€æœ‰æ›´æ”¹ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
- ğŸ” **å®‰å…¨ API å¯†é’¥ç®¡ç†** - ä»…é€šè¿‡ç¯å¢ƒå˜é‡
- ğŸ“Š **å…¨é¢ç›‘æ§ä»ªè¡¨æ¿** - å®æ—¶ SSE æ›´æ–°
- ğŸ” **å¢å¼ºæ—¥å¿—è®°å½•** - Anthropic å’Œ OpenRouter æ¨¡å¼çš„è¯¦ç»†æ—¥å¿—
- ğŸ”’ **API å¯†é’¥æ©ç ** - æ—¥å¿—ä¸ UI å®‰å…¨ä¿æŠ¤
- ğŸ“ˆ **æ€§èƒ½æŒ‡æ ‡** ä¸å¯è¿‡æ»¤çš„ token ä½¿ç”¨è·Ÿè¸ª
- ğŸŒŠ **å®Œæ•´æµå¼æ”¯æŒ** - é€å—åˆ†æ
- ğŸ’¾ **æ™ºèƒ½æ•°æ®å¯¼å‡º** - å‹ç¼©å¯¼å‡ºä¸è¿‡æ»¤åŠŸèƒ½
- ğŸ³ **Docker æ”¯æŒ** - ç”Ÿäº§ç¯å¢ƒç¤ºä¾‹
- âš¡ **ç”Ÿäº§å°±ç»ª** - PM2 å’Œ systemd é…ç½®

## ğŸ“ é¡¹ç›®ç»“æ„

```
anthropic-proxy/
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ server.js          # ä¸»æœåŠ¡å™¨åº”ç”¨
â”‚   â”œâ”€â”€ monitor/           # ç›‘æ§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ store.js       # è¯·æ±‚/å“åº”å­˜å‚¨
â”‚   â”‚   â””â”€â”€ ui.js          # Web ç›‘æ§ç•Œé¢
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ examples/              # é…ç½®ç¤ºä¾‹
â”‚   â”œâ”€â”€ Dockerfile         # Docker å®¹å™¨è®¾ç½®
â”‚   â”œâ”€â”€ docker-compose.yml # Docker Compose é…ç½®
â”‚   â””â”€â”€ pm2.config.js      # PM2 è¿›ç¨‹ç®¡ç†
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â””â”€â”€ LICENSE
```

## ğŸ”€ ä¸¤ç§æ ¸å¿ƒåŠŸèƒ½æ¨¡å¼

### åŠŸèƒ½ä¸€ï¼šç›´è¿ Anthropic APIï¼ˆé»˜è®¤æ¨¡å¼ï¼‰
**ä½œç”¨**ï¼šä½œä¸ºé€æ˜ä»£ç†ï¼ŒåŸæ ·è½¬å‘ Claude Code è¯·æ±‚åˆ° Anthropic APIï¼Œæä¾›å®Œæ•´ç›‘æ§

**ä½¿ç”¨æ–¹æ³•**ï¼š
1. å¯åŠ¨ä»£ç†æœåŠ¡å™¨ï¼š
   ```bash
   npx github:kingoliang/anthropic-proxy
   ```
2. é…ç½® Claude Code ä½¿ç”¨ä»£ç†ï¼š
   ```bash
   export ANTHROPIC_BASE_URL=http://localhost:8082
   ```
3. ç»§ç»­ä½¿ç”¨ Claude Codeï¼ŒAnthropic API å¯†é’¥é€šè¿‡è¯·æ±‚å¤´ä¼ é€’ï¼ˆx-api-key æˆ– authorizationï¼‰
4. åœ¨ `http://localhost:8082/monitor` å®æ—¶ç›‘æ§æ‰€æœ‰è¯·æ±‚

**ä¸€é”®å¯åŠ¨ç¤ºä¾‹**ï¼š
```bash
ANTHROPIC_BASE_URL=http://localhost:8082 claude
```

**ä¼˜åŠ¿**ï¼š
- âœ… é›¶ä»£ç æ›´æ”¹ï¼Œå®Œå…¨å…¼å®¹ç°æœ‰ Claude Code è®¾ç½®
- âœ… ä¿æŒåŸç”Ÿ Anthropic API ä½“éªŒ
- âœ… å®Œæ•´è¯·æ±‚/å“åº”ç›‘æ§ä¸åˆ†æ
- âœ… æ”¯æŒæ‰€æœ‰ Anthropic æ¨¡å‹å’ŒåŠŸèƒ½

### åŠŸèƒ½äºŒï¼šè½¬æ¢ Anthropic API æ ¼å¼åˆ° OpenRouter API
**ä½œç”¨**ï¼šå°† Claude Code å‘å‡ºçš„ Anthropic API è¯·æ±‚æ™ºèƒ½è½¬æ¢ä¸º OpenRouter æ ¼å¼ï¼Œè®©æ‚¨ä½¿ç”¨æ›´ä¾¿å®œçš„ç¬¬ä¸‰æ–¹æ¨¡å‹

**ä½¿ç”¨æ–¹æ³•**ï¼š
1. è®¾ç½® OpenRouter API å¯†é’¥ï¼š
   ```bash
   export OPENROUTER_API_KEY=sk-or-v1-your_key_here
   ```
2. å¯åŠ¨ä»£ç†æœåŠ¡å™¨ï¼š
   ```bash
   npx github:kingoliang/anthropic-proxy
   ```
3. æ‰“å¼€é…ç½®ç•Œé¢åˆ‡æ¢æ¨¡å¼ï¼š
   ```bash
   open http://localhost:8082/config
   ```
4. åœ¨ Web ç•Œé¢é€‰æ‹©ã€ŒOpenRouterã€æ¨¡å¼
5. é…ç½®æ¨¡å‹æ˜ å°„ï¼ˆå¯é€‰ï¼‰ï¼š
   - Sonnet â†’ é€‰æ‹©ä¸€ä¸ª OpenRouter æ¨¡å‹
   - Opus â†’ é€‰æ‹©ä¸€ä¸ª OpenRouter æ¨¡å‹  
   - Haiku â†’ é€‰æ‹©ä¸€ä¸ª OpenRouter æ¨¡å‹
6. ä¿å­˜é…ç½®ï¼Œç»§ç»­æ­£å¸¸ä½¿ç”¨ Claude Code

**å®Œæ•´ç¤ºä¾‹**ï¼š
```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡
export OPENROUTER_API_KEY=sk-or-v1-your_key_here
export ANTHROPIC_BASE_URL=http://localhost:8082

# 2. å¯åŠ¨ä»£ç†
npx github:kingoliang/anthropic-proxy

# 3. åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://localhost:8082/config åˆ‡æ¢åˆ° OpenRouter æ¨¡å¼

# 4. ä½¿ç”¨ Claude Codeï¼ˆä¼šè‡ªåŠ¨ä½¿ç”¨ OpenRouter çš„æ¨¡å‹ï¼‰
claude
```

**ä¼˜åŠ¿**ï¼š
- ğŸ’° **æˆæœ¬èŠ‚çº¦**ï¼šä½¿ç”¨ OpenRouter æ›´ä¾¿å®œçš„ç¬¬ä¸‰æ–¹æ¨¡å‹
- ğŸ”„ **è‡ªåŠ¨è½¬æ¢**ï¼šè¯·æ±‚/å“åº”æ ¼å¼è‡ªåŠ¨è½¬æ¢ï¼ŒClaude Code æ— æ„ŸçŸ¥
- ğŸŒ **æ›´å¤šé€‰æ‹©**ï¼š99+ æ¨¡å‹å¯é€‰ï¼ŒåŒ…æ‹¬å„ç§å¼€æºå’Œå•†ä¸šæ¨¡å‹
- ğŸ“Š **å®Œæ•´ç›‘æ§**ï¼šè½¬æ¢è¿‡ç¨‹é€æ˜ï¼Œå¯æŸ¥çœ‹åŸå§‹è¯·æ±‚å’Œè½¬æ¢åçš„ OpenRouter è¯·æ±‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šç›´æ¥ä» GitHub è¿è¡Œï¼ˆæ¨èï¼‰
```bash
# æ— éœ€å…‹éš†å³å¯ç«‹å³è¿è¡Œ
npx github:kingoliang/anthropic-proxy

# æˆ–ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
PORT=3000 LOG_LEVEL=DEBUG npx github:kingoliang/anthropic-proxy
```

### æ–¹å¼ 2ï¼šå…‹éš†åˆ°æœ¬åœ°è¿è¡Œ
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/kingoliang/anthropic-proxy.git
cd anthropic-proxy

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®ä½ çš„é…ç½®

# å¯åŠ¨æœåŠ¡å™¨
npm start
# æˆ–
npx .
```

### æ–¹å¼ 3ï¼šå…¨å±€å®‰è£…
```bash
# ä» GitHub å…¨å±€å®‰è£…
npm install -g github:kingoliang/anthropic-proxy

# åœ¨ä»»æ„ç›®å½•è¿è¡Œ
anthropic-proxy

# ä½¿ç”¨ç¯å¢ƒå˜é‡
PORT=3000 LOG_LEVEL=DEBUG anthropic-proxy
```

### æ–¹å¼ 4ï¼šå¼€å‘æ¨¡å¼
```bash
# å…‹éš†å¹¶é“¾æ¥ç”¨äºå¼€å‘
git clone https://github.com/kingoliang/anthropic-proxy.git
cd anthropic-proxy
npm install
npm link

# éšå¤„è¿è¡Œ
anthropic-proxy
```

## ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8082

# API åŸºç¡€ URL
ANTHROPIC_BASE_URL=https://api.anthropic.com

# è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
REQUEST_TIMEOUT=120000

# æ—¥å¿—çº§åˆ«
LOG_LEVEL=INFO

# OpenRouter é…ç½®ï¼ˆOpenRouter æ¨¡å¼å¿…éœ€ï¼‰
OPENROUTER_API_KEY=your_openrouter_api_key_here
```

### é…ç½®å®æ—¶ç”Ÿæ•ˆ

é…ç½®æ›´æ”¹**æ— éœ€é‡å¯**å³å¯ç«‹å³ç”Ÿæ•ˆï¼š

- **ä»£ç†æ¨¡å¼**ï¼šé€šè¿‡ Web UI åœ¨ Anthropic/OpenRouter é—´ç¬æ—¶åˆ‡æ¢
- **æ¨¡å‹æ˜ å°„**ï¼šæ›´æ–° 3 æ—æ˜ å°„ï¼ˆSonnet/Opus/Haikuï¼‰ï¼Œæ–°è¯·æ±‚ç«‹å³åº”ç”¨
- **æ¨¡å‹åˆ—è¡¨**ï¼šOpenRouter API åŠ¨æ€åŠ è½½ï¼Œ1 å°æ—¶æ™ºèƒ½ç¼“å­˜
- **API å¯†é’¥**ï¼šæ¯æ¬¡è¯·æ±‚ä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œç¡®ä¿æœ€å¤§å®‰å…¨æ€§
- **æ‰‹åŠ¨é‡è½½**ï¼šè°ƒç”¨ `POST /api/config/reload` å¼ºåˆ¶åˆ·æ–°é…ç½®å’Œç¯å¢ƒ
- **UI åé¦ˆ**ï¼šToast é€šçŸ¥ç¡®è®¤æ‰€æœ‰é…ç½®æ›´æ”¹


## ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£è¿è¡Œ
PORT=3000 npx github:kingoliang/anthropic-proxy

# ä½¿ç”¨è°ƒè¯•æ¨¡å¼è¿è¡Œ
LOG_LEVEL=DEBUG npx github:kingoliang/anthropic-proxy

# åŒæ—¶è®¾ç½®å¤šä¸ªç¯å¢ƒå˜é‡
PORT=3000 LOG_LEVEL=DEBUG npx github:kingoliang/anthropic-proxy
```

## API ç«¯ç‚¹

### ä»£ç†ç«¯ç‚¹
- `POST /v1/messages` - ä¸»æ¶ˆæ¯ç«¯ç‚¹ï¼ˆæ”¯æŒæµå¼å“åº”ï¼‰
- `POST /v1/messages/count_tokens` - Token è®¡æ•°ç«¯ç‚¹
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /` - é‡å®šå‘åˆ°ç›‘æ§ç•Œé¢

### ç›‘æ§ç«¯ç‚¹
- `GET /monitor` - Web ç›‘æ§ä»ªè¡¨æ¿
- `GET /api/monitor/requests` - è·å–å¸¦è¿‡æ»¤çš„è¯·æ±‚åˆ—è¡¨
- `GET /api/monitor/requests/:id` - æ ¹æ® ID è·å–å•ä¸ªè¯·æ±‚
- `GET /api/monitor/stats` - è·å–å®æ—¶ç»Ÿè®¡ï¼ˆæ”¯æŒç­›é€‰å‚æ•°ï¼‰
- `GET /api/monitor/stream` - æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰å®æ—¶æ›´æ–°
- `POST /api/monitor/clear` - æ¸…ç©ºæ‰€æœ‰ç›‘æ§æ•°æ®
- `GET /api/monitor/export` - å¯¼å‡ºç›‘æ§æ•°æ®ä¸º JSONï¼ˆæ”¯æŒç­›é€‰å‚æ•°ï¼‰
- `GET /api/monitor/analyze` - ç”Ÿæˆåˆ†ææŠ¥å‘Šï¼ˆæ”¯æŒç­›é€‰å‚æ•°ï¼‰
- `GET /api/monitor/config` - è·å–æœåŠ¡å™¨ä¿¡æ¯ï¼ˆlogLevelã€portã€hostï¼‰

### é…ç½®ç«¯ç‚¹
- `GET /config` - é«˜çº§é…ç½®ç•Œé¢ï¼Œå¯æœç´¢æ¨¡å‹é€‰æ‹©
- `GET /api/config` - è·å–å½“å‰é…ç½®ï¼Œé›†æˆå®æ—¶ç¯å¢ƒ
- `POST /api/config` - æ›´æ–°å¹¶æŒä¹…åŒ–é…ç½®ï¼Œç«‹å³ç”Ÿæ•ˆ
- `POST /api/config/reset` - é‡ç½®ä¸ºé»˜è®¤é…ç½®ï¼Œå¸¦ç¡®è®¤æç¤º
- `POST /api/config/test-openrouter` - ä»ç¯å¢ƒéªŒè¯ OpenRouter API Key
- `GET /api/config/models` - åˆ—å‡ºå¯ç”¨ OpenRouter æ¨¡å‹ï¼ˆ1å°æ—¶æ™ºèƒ½ç¼“å­˜ï¼‰
- `POST /api/config/reload` - å¼ºåˆ¶é‡æ–°åŠ è½½é…ç½®å’Œç¯å¢ƒå˜é‡

## ç›‘æ§ä»ªè¡¨æ¿

è®¿é—®ï¼š`http://localhost:8082/monitor`

- **å®æ—¶è¯·æ±‚/å“åº”è·Ÿè¸ª** - æ”¯æŒ Anthropic å’Œ OpenRouter åŒæ¨¡å¼
- **æ€§èƒ½æŒ‡æ ‡ä»ªè¡¨æ¿** - æŒ‰ç­›é€‰æ¡ä»¶åŠ¨æ€æ›´æ–°
- **æµåˆ†å—æ—¶é—´çº¿å¯è§†åŒ–** - è¯¦ç»†æ—¶åºåˆ†æ
- **åŒæ¨¡å¼æ—¥å¿—è®°å½•** - ä¸¤ç§ä»£ç†æ¨¡å¼çš„å…¨é¢æ—¥å¿—ä¸åŸå§‹å“åº”æ•°æ®
- **API å¯†é’¥æ©ç ** - å®‰å…¨ä¿æŠ¤ï¼ˆä»…ç¯å¢ƒå˜é‡ï¼‰
- **æ™ºèƒ½ç­›é€‰ç³»ç»Ÿ** - çŠ¶æ€ã€æ¨¡å‹ã€æ—¶é—´èŒƒå›´ã€æä¾›å•†
  - ç­›é€‰æ¡ä»¶åº”ç”¨äºç»Ÿè®¡ã€å¯¼å‡ºã€åˆ†æç­‰æ‰€æœ‰åŠŸèƒ½
  - æ¨¡å‹åˆ—è¡¨æ˜¾ç¤ºä¸¤ä¸ªæä¾›å•†çš„æ‰€æœ‰å¯ç”¨æ¨¡å‹
- **é«˜çº§æ•°æ®å¯¼å‡º** - å¸¦å‹ç¼©å¯¼å‡ºé€‰é¡¹çš„ç­›é€‰æ•°æ®
- **è¯¦ç»†åˆ†ææŠ¥å‘Š** - æä¾›å•†ç‰¹å®šçš„æ´å¯Ÿå’Œæ€§èƒ½æŒ‡æ ‡
- **SSE è‡ªåŠ¨åˆ·æ–°** - æ— éœ€é¡µé¢é‡è½½çš„å®æ—¶æ›´æ–°
- **æä¾›å•†é€æ˜åº¦** - æ¸…æ™°æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ª API åç«¯

### ä»ªè¡¨æ¿æ¨¡å—
1. æ™ºèƒ½ç»Ÿè®¡é¢æ¿
2. é«˜çº§ç­›é€‰å™¨ï¼ˆçŠ¶æ€/æ¨¡å‹/æ—¶é—´èŒƒå›´ï¼‰
3. è¯·æ±‚åˆ—è¡¨ï¼ˆå¯ç­›é€‰ã€å®æ—¶åˆ·æ–°ï¼‰
4. è¯¦æƒ…è§†å›¾ï¼ˆå®Œæ•´è¯·æ±‚/å“åº”æ£€æŸ¥ï¼‰
5. æµåˆ†æï¼ˆé€å—æµå¼å¯è§†åŒ–ï¼‰
6. å¯¼å‡ºå·¥å…·ï¼ˆæ”¯æŒç­›é€‰ï¼‰
7. åˆ†ææŠ¥å‘Šï¼ˆåŸºäºç­›é€‰æ•°æ®ï¼‰

## å®‰å…¨è¯´æ˜

- **API å¯†é’¥**ï¼šä»…å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ - ç»ä¸åœ¨é…ç½®æ–‡ä»¶ä¸­
- **è‡ªåŠ¨æ©ç ** - æ—¥å¿—å’Œç›‘æ§ç•Œé¢ä¸­ï¼ˆå‰ 10 ä½ + "..." + å 4 ä½ï¼‰
- **æ— éœ€è®¤è¯** - ç›‘æ§ä»ªè¡¨æ¿ï¼ˆè®¾è®¡ç”¨äºæœ¬åœ°å¼€å‘ä½¿ç”¨ï¼‰
- **æ•æ„Ÿå¤´è¿‡æ»¤** - è¯·æ±‚æ—¥å¿—ä¸­è‡ªåŠ¨è¿‡æ»¤
- **å®‰å…¨æäº¤** - `config.json` ä¸å«æœºå¯† - ä»…æ¨¡å‹æ˜ å°„å’Œè®¾ç½®
- **ç¯å¢ƒéš”ç¦»** - æ‰€æœ‰æ•æ„Ÿæ•°æ®é€šè¿‡ `.env` æ–‡ä»¶ï¼ˆæ’é™¤ç‰ˆæœ¬æ§åˆ¶ï¼‰
- **æœ¬åœ°æ•°æ®** - æ‰€æœ‰é…ç½®å’Œç›‘æ§æ•°æ®ä¿ç•™åœ¨ä½ çš„æœºå™¨ä¸Š
- **API å¯†é’¥éªŒè¯** - å®æ—¶æµ‹è¯•ç¡®ä¿ä½¿ç”¨å‰å¯†é’¥æœ‰æ•ˆ

## ç³»ç»Ÿè¦æ±‚

- **Node.js 18+**
- **API å¯†é’¥**ï¼š
  - Anthropic API å¯†é’¥ï¼ˆä¾› Claude Code ä½¿ç”¨ï¼‰é€šè¿‡è¯·æ±‚å¤´ï¼ˆ`x-api-key` æˆ– `authorization`ï¼‰
  - OpenRouter API å¯†é’¥ï¼ˆå¯é€‰ï¼‰é€šè¿‡ `OPENROUTER_API_KEY` ç¯å¢ƒå˜é‡
- **ç½‘ç»œ**ï¼šè®¿é—® Anthropic API å’Œ/æˆ– OpenRouter API çš„å‡ºç«™æƒé™
- **æµè§ˆå™¨**ï¼šæ”¯æŒ HTML5 æ•°æ®åˆ—è¡¨çš„ç°ä»£æµè§ˆå™¨ï¼Œç”¨äºé…ç½®ç•Œé¢

## ğŸ¯ åœ¨ Claude Code ä¸­ä½¿ç”¨

### æ­¥éª¤ 1ï¼šå¯åŠ¨ä»£ç†æœåŠ¡å™¨
```bash
# é»˜è®¤ç«¯å£ 8082
npx github:kingoliang/anthropic-proxy

# è‡ªå®šä¹‰ç«¯å£ï¼ˆå¦‚ 3000ï¼‰
PORT=3000 npx github:kingoliang/anthropic-proxy
```

### æ­¥éª¤ 2ï¼šé…ç½® Claude Code ç¯å¢ƒ
è®¾ç½®ç¯å¢ƒå˜é‡æŒ‡å‘ä½ çš„ä»£ç†ï¼š

```bash
# é»˜è®¤ç«¯å£ 8082
export ANTHROPIC_BASE_URL=http://localhost:8082

# è‡ªå®šä¹‰ç«¯å£ï¼ˆå¦‚ 3000ï¼‰
export ANTHROPIC_BASE_URL=http://localhost:3000
```

### æ­¥éª¤ 3ï¼šå¯åŠ¨ Claude Code
```bash
claude
```

### å…¶ä»–é…ç½®æ–¹æ³•

**æ–¹æ³• 1ï¼šå†…è”ç¯å¢ƒå˜é‡**
```bash
ANTHROPIC_BASE_URL=http://localhost:8082 claude
```

**æ–¹æ³• 2ï¼šæ·»åŠ åˆ° shell é…ç½®æ–‡ä»¶**
```bash
echo 'export ANTHROPIC_BASE_URL=http://localhost:8082' >> ~/.bashrc
source ~/.bashrc
```

**æ–¹æ³• 3ï¼šåˆ›å»ºå¯åŠ¨è„šæœ¬**
```bash
#!/bin/bash
# start-claude-with-proxy.sh
export ANTHROPIC_BASE_URL=http://localhost:8082
claude
```

### OpenRouter æ¨¡å¼è®¾ç½®
1. **è®¾ç½® API Key**ï¼šåœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ  `OPENROUTER_API_KEY=your_key_here`ï¼ˆå¿…éœ€ï¼‰
2. **è®¿é—®é…ç½®**ï¼šæ‰“å¼€ `http://localhost:8082/config`
3. **åˆ‡æ¢æ¨¡å¼**ï¼šåœ¨ Web ç•Œé¢é€‰æ‹©ã€ŒOpenRouterã€æ¨¡å¼
4. **é…ç½®æ¨¡å‹**ï¼šè®¾ç½® 3 æ—æ¨¡å‹æ˜ å°„ï¼ˆSonnetâ†’æ¨¡å‹ï¼ŒOpusâ†’æ¨¡å‹ï¼ŒHaikuâ†’æ¨¡å‹ï¼‰
   - ä» 99+ å¯ç”¨ OpenRouter æ¨¡å‹ä¸­æœç´¢é€‰æ‹©
   - æ¨¡å‹åŠ¨æ€è·å–ï¼Œ1 å°æ—¶ç¼“å­˜
   - ä½¿ç”¨å†…ç½®è¿‡æ»¤çš„å¯æœç´¢ä¸‹æ‹‰åˆ—è¡¨
5. **ä¿å­˜æµ‹è¯•**ï¼šä¿å­˜é…ç½®å¹¶æµ‹è¯•è¿æ¥ï¼ˆToast å³æ—¶åé¦ˆï¼‰
6. **å®æ—¶æ›´æ–°**ï¼šæ‰€æœ‰æ›´æ”¹ç«‹å³ç”Ÿæ•ˆ - æ— éœ€é‡å¯
7. **ç›‘æ§ä½¿ç”¨**ï¼šåœ¨ç›‘æ§ä»ªè¡¨æ¿æŸ¥çœ‹è¯¦ç»†æ—¥å¿—å’ŒæŒ‡æ ‡

**å·¥ä½œåŸç†ï¼š**
- è¯·æ±‚è‡ªåŠ¨ä» Anthropic æ ¼å¼è½¬æ¢ä¸º OpenAI/OpenRouter æ ¼å¼
- å“åº”è½¬æ¢å› Anthropic æ ¼å¼ï¼Œå®Œå…¨å…¼å®¹ Claude Code
- å®Œæ•´æµå¼æ”¯æŒï¼Œé€å—å¤„ç†
- å…¨é¢æ—¥å¿—æ˜¾ç¤ºåŸå§‹ OpenRouter å“åº”å’Œè½¬æ¢åè¾“å‡º

## æŠ€æœ¯ç»†èŠ‚

- æ¡†æ¶ï¼šExpress.js + ES Modules
- ç›‘æ§ï¼šå†…å­˜å­˜å‚¨ + å¾ªç¯ç¼“å†²åŒºï¼ˆæœ€å¤š 1000 ä¸ªè¯·æ±‚ï¼‰
- å®æ—¶æ›´æ–°ï¼šServer-Sent Events (SSE)
- æµå¤„ç†ï¼šå®Œæ•´åˆ†å—è·Ÿè¸ªä¸å†…å®¹åˆå¹¶
- é”™è¯¯å¤„ç†ï¼šå…¨é¢çš„é”™è¯¯æ•è·ä¸æ—¥å¿—

## ğŸ³ éƒ¨ç½²åˆ°ç”Ÿäº§

### Docker
```bash
docker build -t anthropic-proxy .
docker run -p 8082:8082 anthropic-proxy

# æˆ–ä½¿ç”¨ Docker Compose
docker-compose -f examples/docker-compose.yml up
```

### PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
```bash
npm install -g pm2
pm2 start examples/pm2.config.js
pm2 monit
pm2 stop anthropic-proxy
```

### Systemd æœåŠ¡
```bash
sudo nano /etc/systemd/system/anthropic-proxy.service

[Unit]
Description=Anthropic API Proxy
After=network.target

[Service]
Type=simple
User=nodejs
WorkingDirectory=/path/to/anthropic-proxy
ExecStart=/usr/bin/node src/server.js
Restart=always
Environment=NODE_ENV=production
Environment=PORT=8082

[Install]
WantedBy=multi-user.target

# å¯ç”¨å¹¶å¯åŠ¨
sudo systemctl enable anthropic-proxy
sudo systemctl start anthropic-proxy
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ç«¯å£è¢«å ç”¨**ï¼šä¿®æ”¹ `PORT` ç¯å¢ƒå˜é‡æˆ–ç»ˆæ­¢ç°æœ‰è¿›ç¨‹
2. **API å¯†é’¥ä¸ç”Ÿæ•ˆ**ï¼š
   - éªŒè¯ Claude Code è¯·æ±‚å¤´ä¸­çš„ Anthropic å¯†é’¥æ ¼å¼
   - æ£€æŸ¥ OpenRouter å¯†é’¥åœ¨ `.env` æ–‡ä»¶ä¸­è®¾ä¸º `OPENROUTER_API_KEY`
   - ä½¿ç”¨é…ç½®é¡µé¢æµ‹è¯• OpenRouter è¿æ¥
3. **OpenRouter è¿æ¥å¤±è´¥**ï¼šéªŒè¯ API å¯†é’¥å’Œåˆ° openrouter.ai çš„ç½‘ç»œè®¿é—®
4. **æ¨¡å‹æ˜ å°„é—®é¢˜**ï¼šä½¿ç”¨é…ç½®ç•Œé¢ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©æœ‰æ•ˆæ¨¡å‹
5. **é…ç½®æ— æ³•ä¿å­˜**ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™å’Œç£ç›˜ç©ºé—´
6. **è¶…æ—¶é”™è¯¯**ï¼šä¸ºæ…¢æ¨¡å‹å¢å¤§ `REQUEST_TIMEOUT` å€¼
7. **å†…å­˜ä½¿ç”¨**ï¼šç›‘æ§æ•°æ®åœ¨ 1000 æ¡åè‡ªåŠ¨è½®æ¢
8. **æ‰¾ä¸åˆ°æ¨¡å—**ï¼šç¡®è®¤åœ¨æ­£ç¡®ç›®å½•è¿è¡Œ
9. **Toast é€šçŸ¥ä¸å·¥ä½œ**ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡æ–°åŠ è½½é…ç½®é¡µé¢

### è°ƒè¯•æ¨¡å¼
```bash
LOG_LEVEL=DEBUG npx github:kingoliang/anthropic-proxy
```

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8082/health
```

## ğŸ”— ç›¸å…³é“¾æ¥

- GitHub ä»“åº“: https://github.com/kingoliang/anthropic-proxy
- NPM åŒ…: `npx github:kingoliang/anthropic-proxy`
- Anthropic API æ–‡æ¡£: https://docs.anthropic.com/
- Docker Hub: ï¼ˆå³å°†æ¨å‡ºï¼‰

## ğŸ¤ è´¡çŒ®

æ­¤ä»£ç†æœåŠ¡å™¨ä¸“ä¸ºå¼€å‘ä¸æµ‹è¯•ç›®çš„è®¾è®¡ã€‚æ¬¢è¿è´¡çŒ®ï¼š

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ·»åŠ æµ‹è¯•ï¼ˆå¦‚é€‚ç”¨ï¼‰
5. æäº¤ PR

## ğŸ“„ è®¸å¯è¯

MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](../LICENSE)ã€‚

## ğŸ™ è‡´è°¢

- ä½¿ç”¨ [Express.js](https://expressjs.com/) æ„å»º
- ç›‘æ§ UI ç”± [Alpine.js](https://alpinejs.dev/) ä¸ [Tailwind CSS](https://tailwindcss.com/) é©±åŠ¨
- åœ¨ [Claude Code](https://claude.ai/code) çš„ååŠ©ä¸‹ç”Ÿæˆ